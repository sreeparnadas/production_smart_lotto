"use strict";(self.webpackChunkaccounts=self.webpackChunkaccounts||[]).push([[771],{8771:function(e,t,a){a.r(t),a.d(t,{TerminalReportModule:function(){return W}});var r=a(8583),i=a(3423),n=a(1982),o=a(8259),l=a.n(o),s=a(7716),d=a(9765),c=a(205),m=a(2340),u=a(5304),p=a(8307),h=a(1841),g=a(4889),Z=a(3535);let b=(()=>{class e{constructor(e,t,a){this.http=e,this.errorService=t,this.authService=a,this.BASE_API_URL=m.N.BASE_API_URL,this.barcodeReportRecords=[],this.terminalSaleRRecords=[],this.cardTerminalSaleRRecords=[],this.userData=JSON.parse(localStorage.getItem("user")),this.barcodeReportRecordsSubject=new d.xQ,this.terminalSaleRecordsSubject=new d.xQ,this.cardTerminalSaleRecordsSubject=new d.xQ}terminalListListener(){return this.barcodeReportRecordsSubject.asObservable()}terminalSaleListListener(){return this.terminalSaleRecordsSubject.asObservable()}cardTerminalSaleListListener(){return this.cardTerminalSaleRecordsSubject.asObservable()}cancelTicket(e){return this.http.post(this.BASE_API_URL+"/cancelTicket",{play_master_id:e}).pipe((0,u.K)(this.handleError),(0,p.b)(e=>{if(e.data){this.authService.updateUserBalance(e.point);const t=this.barcodeReportRecords.findIndex(t=>t.play_master_id===e.id);this.barcodeReportRecords[t].is_cancelled=1,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords])}}))}claimPrize(e){return this.http.post(this.BASE_API_URL+"/claimPrize",{play_master_id:e}).pipe((0,u.K)(this.handleError),(0,p.b)(e=>{if(e.point){this.authService.updateUserBalance(e.point);const t=this.barcodeReportRecords.findIndex(t=>t.play_master_id===e.id);this.barcodeReportRecords[t].is_claimed=1,this.barcodeReportRecords[t].is_cancelled=1,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords])}}))}getTerminalReport(e,t,a){return this.http.post(this.BASE_API_URL+"/terminal/barcodeReport",{terminalId:e,startDate:t,endDate:a}).pipe((0,u.K)(this.handleError),(0,p.b)(e=>{e.data&&(this.barcodeReportRecords=e.data,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords]))}))}getTerminalSaleReport(e,t,a){return this.http.post(this.BASE_API_URL+"/terminal/terminalSaleReports",{terminalId:e,startDate:t,endDate:a}).pipe((0,u.K)(this.handleError),(0,p.b)(e=>{e.data&&(this.terminalSaleRRecords=e.data,this.terminalSaleRecordsSubject.next([...this.terminalSaleRRecords]))}))}getCardTerminalSaleReport(e,t,a){return this.http.post(this.BASE_API_URL+"/terminal/terminalCardSaleReports",{terminalId:e,startDate:t,endDate:a}).pipe((0,u.K)(this.handleError),(0,p.b)(e=>{e.data&&(this.cardTerminalSaleRRecords=e.data,this.cardTerminalSaleRecordsSubject.next([...this.cardTerminalSaleRRecords]))}))}serverError(e){return e instanceof Response?(0,c._)("backend server error"):(0,c._)(0===e.status?{status:e.status,message:"Backend Server is not Working",statusText:e.statusText}:401===e.status?{status:e.status,message:"Your are not authorised",statusText:e.statusText}:e)}handleError(e){return e.error.message.includes("1062")?(0,c._)("Record already exists"):(0,c._)(e.error.message)}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(h.eN),s.LFG(g.T),s.LFG(Z.e))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var f=a(1140),T=a(5620),A=a(5939),_=a(8295),q=a(9983),S=a(3220),R=a(3679),x=a(1095),D=a(1494),v=a(6073),U=a(346);function k(e,t){if(1&e&&(s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.TgZ(5,"td"),s._uU(6),s.qZA(),s.TgZ(7,"td"),s._uU(8),s.qZA(),s.TgZ(9,"td"),s._uU(10),s.qZA(),s.qZA()),2&e){const e=t.$implicit;s.xp6(2),s.Oqu(e.date),s.xp6(2),s.Oqu(e.total),s.xp6(2),s.Oqu(e.commission),s.xp6(2),s.Oqu(e.prize_value),s.xp6(2),s.Oqu(e.total-e.commission-e.prize_value)}}function y(e,t){1&e&&(s.TgZ(0,"div",29),s.TgZ(1,"h1"),s._uU(2,"No Data"),s.qZA(),s.qZA())}function w(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.TgZ(5,"td"),s._uU(6),s.qZA(),s.TgZ(7,"td"),s._uU(8),s.qZA(),s.TgZ(9,"td"),s._uU(10),s.qZA(),s.TgZ(11,"td"),s._uU(12),s.qZA(),s.TgZ(13,"td"),s._uU(14),s.qZA(),s.TgZ(15,"td"),s.TgZ(16,"button",30),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().claimPrize(t.play_master_id)}),s._uU(17),s.qZA(),s.qZA(),s.TgZ(18,"td"),s.TgZ(19,"button",31),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().cancelTicket(t.play_master_id)}),s._uU(20,"Cancel"),s.qZA(),s.qZA(),s.TgZ(21,"td"),s.TgZ(22,"a",32),s.NdJ("click",function(){const t=s.CHM(e).$implicit,a=s.oxw();return s.MAs(85).show(),a.openPopup(t.play_master_id,t.barcode_number)}),s._UZ(23,"i",33),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit,a=t.index,r=s.oxw();s.xp6(2),s.Oqu(a+1),s.xp6(2),s.Oqu(e.draw_time),s.xp6(2),s.Oqu(e.ticket_taken_time),s.xp6(2),s.Oqu(e.barcode_number),s.xp6(2),s.Oqu(e.total_quantity),s.xp6(2),s.Oqu(e.amount),s.xp6(2),s.Oqu(e.prize_value),s.xp6(2),s.Q6J("hidden",0==e.prize_value)("disabled",1==e.is_claimed),s.xp6(1),s.Oqu(e.prize_value>0?e.is_claimed>0?"Claimed":"Claim":"No Prize"),s.xp6(2),s.Q6J("disabled",r.checkBtnEligibility(e))}}function J(e,t){1&e&&(s.TgZ(0,"div",29),s.TgZ(1,"h1"),s._uU(2,"No Data"),s.qZA(),s.qZA())}function M(e,t){1&e&&(s.TgZ(0,"span"),s._uU(1,"Single"),s.qZA())}function C(e,t){if(1&e&&(s.TgZ(0,"button",46),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.s9C("matBadge",e.quantity),s.xp6(1),s.AsE(" ",e.game_name," ",e.number_set," ")}}function N(e,t){if(1&e&&(s.TgZ(0,"div",44),s.YNc(1,C,2,3,"button",45),s.qZA()),2&e){const e=t.index,a=s.oxw(2);s.xp6(1),s.Q6J("ngForOf",a.barcodeDetails.details.slice(e*a.columnNumber,e*a.columnNumber+a.columnNumber))}}function F(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"div",34),s.TgZ(1,"div",35),s.TgZ(2,"div",36),s.TgZ(3,"h4",37),s._uU(4),s.qZA(),s.TgZ(5,"button",38),s.NdJ("click",function(){return s.CHM(e),s.oxw(),s.MAs(85).hide()}),s.TgZ(6,"span",39),s._uU(7,"\xd7"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(8,"div",40),s.YNc(9,M,2,0,"span",41),s.YNc(10,N,2,1,"div",42),s.qZA(),s._UZ(11,"div",43),s.qZA(),s.qZA()}if(2&e){const e=s.oxw();s.xp6(4),s.hij(" Ticket: ",e.barcodeDetails.barcode," "),s.xp6(5),s.Q6J("ngIf",e.barcodeDetails.details.length),s.xp6(1),s.Q6J("ngForOf",e.barcodeDetails.details.slice(0,e.barcodeDetails.details.length%e.columnNumber==0?e.barcodeDetails.details.length/e.columnNumber:e.barcodeDetails.details.length/e.columnNumber+1))}}const O=[{path:"",canActivate:[n.v],component:(()=>{class e{constructor(e,t,a,i){this.renderer=e,this.terminalReportService=t,this.adminReportService=a,this.commonService=i,this.thisYear=(new Date).getFullYear(),this.thisMonth=(new Date).getMonth(),this.thisDay=(new Date).getDate(),this.startDate=new Date(this.thisYear,this.thisMonth,this.thisDay),this.StartDateFilter=this.startDate,this.EndDateFilter=this.startDate,this.pipe=new r.uU("en-US"),this.columnNumber=5,this.terminalReportData=[],this.terminalSaleReportData=[],this.cardTerminalSaleReportData=[],this.renderer.setStyle(document.body,"background-image","none"),this.terminalReportService.terminalListListener().subscribe(e=>{this.terminalReportData=e}),this.terminalReportService.terminalSaleListListener().subscribe(e=>{this.terminalSaleReportData=e}),this.terminalReportService.cardTerminalSaleListListener().subscribe(e=>{this.cardTerminalSaleReportData=e}),this.getTerminalBarcodeReport(),this.getTerminalSaleReport(),this.commonService.terminalCancelListListener().subscribe(e=>{e.forEach(function(e){const t=this.terminalReportData.findIndex(t=>t.play_master_id===e.id);this.terminalReportData[t].is_cancelable=0})})}ngOnInit(){}claimPrize(e){l().fire({title:"Please Wait !",html:"adding points ...",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}}),this.terminalReportService.claimPrize(e).subscribe(e=>{e.point&&l().close()})}checkBtnEligibility(e){return 1===e.is_cancelled||0===e.is_cancelable}cancelTicket(e){l().fire({title:"Confirm Cancel ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, confirm"}).then(t=>{t.isConfirmed?(l().fire({title:"Please Wait !",html:"Confirming cancel",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}}),this.terminalReportService.cancelTicket(e).subscribe(e=>{1===e.success?(l().hideLoading(),l().fire({icon:"success",title:"Cancelled",showConfirmButton:!1,timer:1500})):l().fire({icon:"error",title:"You cannot cancel this ticket",showConfirmButton:!1,timer:2e3})})):t.isDenied&&l().fire("Changes are not saved","","info")})}getTerminalBarcodeReport(){l().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}});const e=JSON.parse(localStorage.getItem("user"));let t=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),a=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalReport(e.userId,t,a).subscribe(e=>{e.data&&l().close()})}getTerminalSaleReport(){l().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}});const e=JSON.parse(localStorage.getItem("user")),t=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),a=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalSaleReport(e.userId,t,a).subscribe(e=>{e.data&&l().close()}),this.terminalReportService.getCardTerminalSaleReport(e.userId,t,a).subscribe(e=>{e.data&&l().close()})}openPopup(e,t){this.adminReportService.getBarcodeDetails(e).subscribe(e=>{this.barcodeDetails=e.data})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(s.Qsj),s.Y36(b),s.Y36(f.Q),s.Y36(T.v))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-terminal-report"]],decls:87,vars:22,consts:[[1,"mt-5","mr-3","ml-3",3,"selectedIndex"],["label","Terminal sale report"],[1,"pt-1","d-flex"],[1,"col-3"],["appearance","fill"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],[3,"ngModel","ngModelChange"],["picker",""],["picker1",""],["mat-button","","color","accent",2,"font-size","20px",3,"click"],["matSort","",1,"table","table-bordered","table-sm",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","total"],["mat-sort-header","commission"],["mat-sort-header","prize_value"],["mat-sort-header","ntp"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["label","Terminal barcode report"],[1,"",2,"overflow","hidden"],["matSort","",1,"table","table-bordered","table-sm","m-3",2,"border","none !important","height","50px","overflow","hidden"],["mat-sort-header","draw_time"],["mat-sort-header","ticket_taken_time"],["mat-sort-header","barcode_number"],["mat-sort-header","total_quantity"],["mat-sort-header","amount"],["mdbModal","","id","frameModalTop","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade","top",2,"overflow-y","auto"],["frame","mdbModal"],["class","modal-dialog modal-lg modal-notify modal-info","role","document","style","min-width: 550px",4,"ngIf"],[1,"text-center"],["type","button",1,"btn","btn-danger",2,"min-width","87px",3,"hidden","disabled","click"],["type","button",1,"btn","btn-danger",3,"disabled","click"],["color","info","mdbWavesEffect","",1,"waves-effect","mb-4",3,"click"],[1,"bi","bi-info-square-fill"],["role","document",1,"modal-dialog","modal-lg","modal-notify","modal-info",2,"min-width","550px"],[1,"modal-content"],[1,"modal-header","text-center"],[1,"modal-title","white-text","font-weight-bold"],["type","button","data-dismiss","modal","aria-label","Close",1,"close",3,"click"],["aria-hidden","true",1,"white-text"],[1,"modal-body"],[4,"ngIf"],["class","d-flex flex-row mt-2",4,"ngFor","ngForOf"],[1,"modal-footer","justify-content-center"],[1,"d-flex","flex-row","mt-2"],["class","mr-2 mt-3",3,"matBadge",4,"ngFor","ngForOf"],[1,"mr-2","mt-3",3,"matBadge"]],template:function(e,t){if(1&e&&(s.TgZ(0,"mat-tab-group",0),s.TgZ(1,"mat-tab",1),s.TgZ(2,"div",2),s.TgZ(3,"div",3),s.TgZ(4,"mat-form-field",4),s.TgZ(5,"mat-label"),s._uU(6,"Start date"),s.qZA(),s.TgZ(7,"input",5),s.NdJ("ngModelChange",function(e){return t.StartDateFilter=e}),s.qZA(),s._UZ(8,"mat-datepicker-toggle",6),s.TgZ(9,"mat-datepicker",7,8),s.NdJ("ngModelChange",function(e){return t.StartDateFilter=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"div",3),s.TgZ(12,"mat-form-field",4),s.TgZ(13,"mat-label"),s._uU(14,"End date"),s.qZA(),s.TgZ(15,"input",5),s.NdJ("ngModelChange",function(e){return t.EndDateFilter=e}),s.qZA(),s._UZ(16,"mat-datepicker-toggle",6),s.TgZ(17,"mat-datepicker",7,9),s.NdJ("ngModelChange",function(e){return t.EndDateFilter=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(19,"button",10),s.NdJ("click",function(){return t.getTerminalSaleReport()}),s._uU(20,"Search"),s.qZA(),s.qZA(),s.TgZ(21,"table",11),s.TgZ(22,"thead"),s.TgZ(23,"tr"),s.TgZ(24,"th"),s._uU(25,"Date"),s.qZA(),s.TgZ(26,"th",12),s._uU(27,"Amount"),s.qZA(),s.TgZ(28,"th",13),s._uU(29,"Commission"),s.qZA(),s.TgZ(30,"th",14),s._uU(31,"Prize"),s.qZA(),s.TgZ(32,"th",15),s._uU(33,"NTP"),s.qZA(),s._UZ(34,"th"),s.qZA(),s.qZA(),s.TgZ(35,"tbody"),s.YNc(36,k,11,5,"tr",16),s.qZA(),s.qZA(),s.YNc(37,y,3,0,"div",17),s.qZA(),s.TgZ(38,"mat-tab",18),s.TgZ(39,"div",2),s.TgZ(40,"div",3),s.TgZ(41,"mat-form-field",4),s.TgZ(42,"mat-label"),s._uU(43,"Start date"),s.qZA(),s.TgZ(44,"input",5),s.NdJ("ngModelChange",function(e){return t.StartDateFilter=e}),s.qZA(),s._UZ(45,"mat-datepicker-toggle",6),s.TgZ(46,"mat-datepicker",7,8),s.NdJ("ngModelChange",function(e){return t.StartDateFilter=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(48,"div",3),s.TgZ(49,"mat-form-field",4),s.TgZ(50,"mat-label"),s._uU(51,"End date"),s.qZA(),s.TgZ(52,"input",5),s.NdJ("ngModelChange",function(e){return t.EndDateFilter=e}),s.qZA(),s._UZ(53,"mat-datepicker-toggle",6),s.TgZ(54,"mat-datepicker",7,9),s.NdJ("ngModelChange",function(e){return t.EndDateFilter=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(56,"button",10),s.NdJ("click",function(){return t.getTerminalBarcodeReport()}),s._uU(57,"Search"),s.qZA(),s.qZA(),s.TgZ(58,"div",19),s.TgZ(59,"table",20),s.TgZ(60,"thead"),s.TgZ(61,"tr"),s.TgZ(62,"th"),s._uU(63,"Sl.NO"),s.qZA(),s.TgZ(64,"th",21),s._uU(65,"Draw Time"),s.qZA(),s.TgZ(66,"th",22),s._uU(67,"Ticket Time"),s.qZA(),s.TgZ(68,"th",23),s._uU(69,"Barcode"),s.qZA(),s.TgZ(70,"th",24),s._uU(71,"Quantity"),s.qZA(),s.TgZ(72,"th",25),s._uU(73,"Amount"),s.qZA(),s.TgZ(74,"th",14),s._uU(75,"Prize"),s.qZA(),s.TgZ(76,"th"),s._uU(77,"Claim"),s.qZA(),s.TgZ(78,"th"),s._uU(79,"Cancel"),s.qZA(),s._UZ(80,"th"),s.qZA(),s.qZA(),s.TgZ(81,"tbody"),s.YNc(82,w,24,11,"tr",16),s.qZA(),s.qZA(),s.YNc(83,J,3,0,"div",17),s.qZA(),s.qZA(),s.qZA(),s.TgZ(84,"div",26,27),s.YNc(86,F,12,3,"div",28),s.qZA()),2&e){const e=s.MAs(10),a=s.MAs(18);s.Q6J("selectedIndex",0),s.xp6(7),s.Q6J("matDatepicker",e)("ngModel",t.StartDateFilter),s.xp6(1),s.Q6J("for",e),s.xp6(1),s.Q6J("ngModel",t.StartDateFilter),s.xp6(6),s.Q6J("matDatepicker",a)("ngModel",t.EndDateFilter),s.xp6(1),s.Q6J("for",a),s.xp6(1),s.Q6J("ngModel",t.EndDateFilter),s.xp6(19),s.Q6J("ngForOf",t.terminalSaleReportData),s.xp6(1),s.Q6J("ngIf",0==t.terminalSaleReportData.length),s.xp6(7),s.Q6J("matDatepicker",e)("ngModel",t.StartDateFilter),s.xp6(1),s.Q6J("for",e),s.xp6(1),s.Q6J("ngModel",t.StartDateFilter),s.xp6(6),s.Q6J("matDatepicker",a)("ngModel",t.EndDateFilter),s.xp6(1),s.Q6J("for",a),s.xp6(1),s.Q6J("ngModel",t.EndDateFilter),s.xp6(28),s.Q6J("ngForOf",t.terminalReportData),s.xp6(1),s.Q6J("ngIf",0==t.terminalReportData.length),s.xp6(3),s.Q6J("ngIf",t.barcodeDetails)}},directives:[A.SP,A.uX,_.KE,_.hX,q.Nt,S.hl,R.Fj,R.JJ,R.On,S.nW,_.R9,S.Mq,x.lW,D.YE,D.nU,r.sg,r.O5,v.oB,v.b6,U.k],styles:[""]}),e})()}];let E=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[i.Bz.forChild(O)],i.Bz]}),e})();var I=a(2103),L=a(5480),Q=a(5566),B=a(3738),P=a(5396),z=a(9870),Y=a(4820),j=a(2458);let W=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[r.ez,E,I.q,A.Nh,L.q,Q.o9,B.QW,R.u5,R.UX,P.rP,D.JX,z.aE,z.bz,v.At,Y.UU,U.g,S.FA,q.c,j.XK,j.si]]}),e})()}}]);